/*
    utils - utility library
    Copyright (c) 2021 on-keyday (https://github.com/on-keyday)
    Released under the MIT license
    https://opensource.org/licenses/mit-license.php
*/

// Code generated by ifacegen (https://github.com/on-keyday/utils)

#pragma once
#include "../../helper/deref.h"

namespace utils::platform::windows {
    template <typename Size>
    struct CompleteBase {
       private:
        struct interface__ {
            virtual void operator()(Size size) = 0;

            virtual ~interface__() {}
        };

        template <class T__>
        struct implements__ : interface__ {
            T__ t_holder_;

            template <class V__>
            implements__(V__&& args)
                : t_holder_(std::forward<V__>(args)) {}

            void operator()(Size size) override {
                auto t_ptr_ = utils::helper::deref(this->t_holder_);
                if (!t_ptr_) {
                    return (void)0;
                }
                return (*t_ptr_)(size);
            }
        };

        interface__* iface = nullptr;

       public:
        constexpr CompleteBase() {}

        constexpr CompleteBase(std::nullptr_t) {}

        template <class T__>
        CompleteBase(T__&& t) {
            if (!utils::helper::deref(t)) {
                return;
            }
            iface = new implements__<std::decay_t<T__>>(std::forward<T__>(t));
        }

        CompleteBase(CompleteBase&& in) {
            iface = in.iface;
            in.iface = nullptr;
        }

        CompleteBase& operator=(CompleteBase&& in) {
            delete iface;
            iface = in.iface;
            in.iface = nullptr;
            return *this;
        }

        explicit operator bool() const {
            return iface != nullptr;
        }

        ~CompleteBase() {
            delete iface;
        }

        void operator()(Size size) {
            return iface ? iface->operator()(size) : (void)0;
        }
    };

    using Complete = CompleteBase<size_t>;

}  // namespace utils::platform::windows
