/*
    utils - utility library
    Copyright (c) 2021 on-keyday (https://github.com/on-keyday)
    Released under the MIT license
    https://opensource.org/licenses/mit-license.php
*/

// Code generated by ifacegen (https://github.com/on-keyday/utils)

#pragma once
#include "../../helper/deref.h"

namespace utils::platform::windwos {
    struct Complate {
       private:
        struct interface__ {
            virtual void operator()() = 0;

            virtual ~interface__() {}
        };

        template <class T>
        struct implements__ : interface__ {
            T t_holder_;

            template <class... Args>
            implements__(Args&&... args)
                : t_holder_(std::forward<Args>(args)...) {}

            void operator()() override {
                auto t_ptr_ = utils::helper::deref(this->t_holder_);
                if (!t_ptr_) {
                    return void{};
                }
                return t_ptr_->operator()();
            }
        };

        interface__* iface = nullptr;

       public:
        constexpr Complate() {}

        constexpr Complate(std::nullptr_t) {}

        template <class T>
        Complate(T&& t) {
            iface = new implements__<std::decay_t<T>>(std::forward<T>(t));
        }

        Complate(Complate&& in) {
            iface = in.iface;
            in.iface = nullptr;
        }

        Complate& operator=(Complate&& in) {
            delete iface;
            iface = in.iface;
            in.iface = nullptr;
            return *this;
        }

        explicit operator bool() const {
            return iface != nullptr;
        }

        ~Complate() {
            delete iface;
        }

        void operator()() {
            return iface ? iface->operator()() : void{};
        }
    };

}  // namespace utils::platform::windwos
