#!/bin/bash
BUILD_TYPE=$2
UTILS_BUILD_TYPE=$1
TARGET=$3
if [ ! $BUILD_TYPE ]; then
BUILD_TYPE=Debug
fi
if [ ! $UTILS_BUILD_TYPE ]; then
UTILS_BUILD_TYPE=shared
fi
INSTALL_PREFIX=$(pwd)
if [ $UTILS_BUILD_TYPE = "wasm" ]; then
# emcmake must be enabled on this context
emcmake cmake -G Ninja -D CMAKE_BUILD_TYPE=$BUILD_TYPE -D UTILS_BUILD_TYPE=static -D CMAKE_INSTALL_PREFIX=$INSTALL_PREFIX -S . -B built/$UTILS_BUILD_TYPE/$BUILD_TYPE
else
cmake -D CMAKE_C_COMPILER=clang -D CMAKE_CXX_COMPILER=clang++ -G Ninja -D CMAKE_BUILD_TYPE=$BUILD_TYPE -D UTILS_BUILD_TYPE=$UTILS_BUILD_TYPE -D CMAKE_INSTALL_PREFIX=$INSTALL_PREFIX -S . -B built/$UTILS_BUILD_TYPE/$BUILD_TYPE
fi
ninja -C built/$UTILS_BUILD_TYPE/$BUILD_TYPE $TARGET
ninja -C built/$UTILS_BUILD_TYPE/$BUILD_TYPE install
